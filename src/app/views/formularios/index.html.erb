<h1 class="text-2xl font-bold mb-4">Distribuir Formulários de Avaliação</h1>

<% if flash[:notice] %>
  <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
    <span class="block sm:inline"><%= flash[:notice] %></span>
  </div>
<% end %>

<% if flash[:alert] %>
  <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
    <span class="block sm:inline"><%= flash[:alert] %></span>
  </div>
<% end %>

<%= form_with url: formularios_path, method: :post, local: true, class: "bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4" do |f| %>
  <div class="mb-4">
    <label class="block text-gray-700 text-sm font-bold mb-2" for="template_id">
      Selecione o Template
    </label>
    <div class="relative">
      <%= f.collection_select :template_id, @templates, :id, :titulo, {}, { class: "block appearance-none w-full bg-gray-200 border border-gray-200 text-gray-700 py-3 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white focus:border-gray-500" } %>
    </div>
  </div>

  <div class="mb-6">
    <label class="block text-gray-700 text-sm font-bold mb-2">
      Selecione as Turmas
    </label>
    <div class="mt-2">
      <% @turmas.each do |turma| %>
        <div class="flex items-center mb-2">
          <%= check_box_tag "turma_ids[]", turma.id, false, class: "form-checkbox h-5 w-5 text-gray-600", id: "turma_#{turma.id}" %>
          <label for="turma_#{turma.id}" class="ml-2 text-gray-700">
            <%= "#{turma.codigo} - #{turma.materia.nome} (#{turma.semestre})" %>
          </label>
        </div>
      <% end %>
    </div>
  </div>

  <div class="flex items-center justify-between">
    <%= f.submit "Distribuir Formulário", class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline cursor-pointer" %>
  </div>
<% end %>

<hr class="my-8 border-gray-300">

<h2 class="text-xl font-bold mb-4">Formulários Cadastrados</h2>

<% if @formularios.any? %>
  <div class="bg-white shadow overflow-hidden sm:rounded-md">
    <ul class="divide-y divide-gray-200">
      <% @formularios.each do |form| %>
        <li class="px-4 py-4 sm:px-6 hover:bg-gray-50 flex items-center justify-between">
          <div>
            <p class="text-sm font-medium text-purple-600 truncate">
              <%= form.template.titulo %>
            </p>
            <p class="ml-2 flex-shrink-0 flex">
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                <%= form.turma.materia.nome %> - <%= form.turma.codigo %>
              </span>
            </p>
          </div>
          <div class="ml-5 flex-shrink-0">
             <%= link_to "Ver Resultados", resultado_path(form), class: "text-indigo-600 hover:text-indigo-900 font-medium" %>
          </div>
        </li>
      <% end %>
    </ul>
  </div>
<% else %>
  <p class="text-gray-500 italic">Nenhum formulário cadastrado</p>
<% end %>